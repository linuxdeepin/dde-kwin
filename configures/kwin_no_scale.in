#!/bin/bash

if [ -n "$HOME" ];then
    cp -n /etc/xdg/kglobalshortcutsrc $HOME/.config/kglobalshortcutsrc
fi

ARGS=$@

function runDeepinKWin() {
    local EXECUTE_PATH=$1
    export LD_PRELOAD=${PLUGIN_INSTALL_PATH}/libdde-kwin-xcb.so:$LD_PRELOAD
    export QT_SCALE_FACTOR=1
    #":"后的"appFilePath=..."会传递给QPlatformIntegration::create调用
    # appFilePath 的值会覆盖 QCoreApplication::applicationPath，以确保kwin崩溃自动重启时也是启动的kwin_no_scale脚本
    kwin_x11 -platform dde-kwin-xcb:appFilePath=$EXECUTE_PATH/kwin_no_scale $ARGS
    return $?
}

runDeepinKWin "$(cd `dirname $0`; pwd)" || kwin_x11 $ARGS
